#! /bin/sh

## ------------------------------------------------------------------------------
## bootstrap: a script to generate a build environment using the GNU autotools
## 
## Author: Jean-Francois Ostiguy
##         Fermilab
##         ostiguy@fnal.gov
##
##-------------------------------------------------------------------------------

set -x

rootdir=`pwd`

## remove remnants of autogenerated files. These files should **never** be put in the
## repository !

find . -name autom4te\.cache -exec  \rm -rf {}  \; -print 
find . -name aclocal\.m4      -exec \rm     {}  \; -print 
find . -name ltmain\.sh       -exec \rm     {}  \; -print 
find . -name config\.guess    -exec \rm     {}  \; -print 
find . -name config\.sub      -exec \rm     {}  \; -print 

## update the list of source files and header files. 

for dir in basic_toolkit bmlfactory mxyzptlk physics_toolkit integrator gms
do
  cd   $dir
  ${rootdir}/updateheaders
  cd ./src
  ${rootdir}/updatesource
  cd ../..
done

cd   beamline
${rootdir}/updateheaders
cd ./src
${rootdir}/updatesource
cd physics/6d
${rootdir}/updatesource
cd ../mad
${rootdir}/updatesource
cd ../../../..


## use autotools to generate the build environment. 
## NOTE:  command invocation order matters !

libtoolize --force --copy
aclocal -I config
automake --add-missing --foreign --copy
autoconf


for dir in basic_toolkit beamline bmlfactory mxyzptlk physics_toolkit integrator gms
do
  cd $dir
  libtoolize --force --copy
  aclocal -I config
  autoheader
  automake --add-missing --foreign --copy
  autoconf
  cd ..
done
